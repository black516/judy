function Chart(a,c,e,b){this.options={title:"",titleAttr:{"font-weight":"bold","font-size":14},margin:[60,20,40,80],bgAttr:{fill:"#ffffff","stroke-width":0},stacked:false,threshold:null,formatX:null,formatY:null,getY:null,showTracker:true,trackerAttr:{"stroke-width":1,opacity:0.5,fill:"#666666"},showGrid:true,gridXAttr:{"stroke-width":1,opacity:0.1,fill:"#666666",},gridYAttr:{"stroke-width":1,opacity:0.1,fill:"#666666",},tickSize:10,tickLength:5,tickInterval:null,tickFixed:2,tickYAttr:{"font-size":12,fill:"#666666",opacity:0.8},tickXAttr:{"font-size":12,fill:"#666666",opacity:0.8},getTickY:null,formatTickY:null,getTickX:null,formatTickX:null,tipAttr:{"stroke-width":2,opacity:0.8,fill:"#f4f4f4",stroke:"#666666",padding:5,textAttr:{"font-size":12,fill:"#000000",opacity:1,"text-anchor":"start"}},getTip:null,lineAttr:{"stroke-width":3,opacity:0.9},lineHoverAttr:{"stroke-width":4,opacity:0.9},dotAttr:{"stroke-width":2,r:3,opacity:1},dotHoverAttr:{"stroke-width":2,r:4,opacity:1},colors:[["#075697"],["#970707"],["#079741"]],animationType:"<",timing:500,dotTiming:100,legendAttr:{}};extend(this.options,b);if(this.options.width==undefined){this.options.width=a.clientWidth}if(this.options.height==undefined){this.options.height=a.clientHeight}var d=Raphael(a,this.options.width,this.options.height);this.setGC(d);this.setType(c);this.setData(e);this.init();return this}Chart.prototype={init:function(){this.elements={series:[],ticks:[[[],[]],[[],[]]],dots:[]};this.setSize({width:this.options.width,height:this.options.height});this.setFrame();this.setMax();this.setMin()},draw:function(){this.render.run(this)},setSize:function(a){this.size=a},getSize:function(){return this.size},setGC:function(a){this.gc=a},getGC:function(){return this.gc},setType:function(type){this.type=type;eval("var Render = "+type+"Render");var render=new Render();this.setRender(render)},setRender:function(a){this.render=a},setData:function(a){this.data=a},setFrame:function(){var a=this.getSize();var b={};b.x=this.options.margin[3];b.y=this.options.margin[0];b.width=a.width-this.options.margin[1]-this.options.margin[3];b.height=a.height-this.options.margin[0]-this.options.margin[2];this.frame=b},getFrame:function(){return this.frame},setMax:function(){var a;if(this.options.stacked){for(var c=0;c<this.data.series[0].length;c++){var b;for(var d=0;d<this.data.series.length;d++){var e=this.getY(this.data.series[d],c);if(d==0){b=e}else{b+=e}}if(c==0){a=b}else{if(b>a){a=b}}}}else{for(var d=0;d<this.data.series.length;d++){for(var c=0;c<this.data.series[d].length;c++){var e=this.getY(this.data.series[d],c);if(d==0&&c==0){a=e}else{if(e>a){a=e}}}}}this.max=a},getMax:function(){return this.options.getMax!=undefined?this.options.getMax():this.max},setMin:function(){var c;for(var b=0;b<this.data.series.length;b++){for(var a=0;a<this.data.series[b].length;a++){var d=this.getY(this.data.series[b],a);if(b==0&&a==0){c=d}else{if(d<c){c=d}}}}this.min=c;return c},getMin:function(){return this.options.getMin!=undefined?this.options.getMin():this.min},getPixX:function(f,e,a){if(a==undefined){a=0}var g=this.getFrame();var b=g.width;var c=b/(f-1);var d=g.x+e*c;if(a==1){c=b/(f);d=g.x+e*c+c/2}return d},getPixY:function(d){var c=this.getSize().height-this.options.margin[0]-this.options.margin[2];var a=this.getMax();var b=this.getMin();return c*(1-(d-b)/(a-b))+this.options.margin[0]},getY:function(b,a){return this.options.getY!=undefined?this.options.getY(b,a):b[a]},getTickY:function(d){var a=this.getMax();var c=this.getMin();var b=(a-c)/this.options.tickSize;var e=decimal(c+b*d,this.options.tickFixed);return this.options.getTickY!=undefined?this.options.getTickY(e,d):e},formatTickY:function(a){var b=this.getTickY(a);return this.options.formatTickY!=undefined?this.options.formatTickY(b,a):b},getTickX:function(a){var b=this.data.categories[a];return this.options.getTickX!=undefined?this.options.getTickX(b,a):b},formatTickX:function(a){var b=this.getTickX(a);return this.options.formatTickX!=undefined?this.options.formatTickX(b,a):b},getTip:function(c,b,a){return this.options.getTip!=undefined?this.options.getTip(c,b):this.data.legends[b]+":"+c[a]},getThreshold:function(){return(this.options.threshold!=null)?this.getPixY(this.options.threshold):this.getPixY(this.getMin())}};function Render(){}Render.prototype={run:function(a){this.context=a;this.data=this.context.data;this.options=this.context.options;this.gc=this.context.getGC();this.init();this.build();this.create();this.draw()},init:function(){this.clear();this.tdata={};this.elements={axes:[],series:[],dots:[],tips:[],tipTexts:[],legends:[[],[]]}},clear:function(){this.gc.clear()},build:function(){this.buildPlotsData()},create:function(){this.createTitle();this.createLegends();this.createAxes();this.createPlots();this.createDots()},draw:function(){var a=this;a.drawTitle();a.drawLegends();a.drawAxes();a.drawBackground();setTimeout(function(){a.drawPlots();a.drawDots()},a.options.timing)},redraw:function(){this.draw()},buildPlotsData:function(){var b=this;this.tdata.series=[];for(var d=0;d<b.data.series.length;d++){this.tdata.series[d]=[];var e=b.data.series[d];for(var c=0;c<e.length;c++){var a=b.context.getPixX(e.length,c,this.align);var f=b.context.getPixY(b.context.getY(e,c));this.tdata.series[d][c]=[a,f]}}},createTitle:function(){var b=this;var d=b.context.getFrame();var a=d.x,e=10;var c=b.gc.text(a,e);c.attr(b.options.titleAttr);c.attr("text-anchor","start");c.attr("text",b.options.title)},createLegends:function(){var j=this;var b=j.context.getFrame();var g=b.x,e=b.y-20;var c=[10,15];for(var d=0;d<j.data.legends.length;d++){var f=j.data.legends[d];if(d>0){g=c[1]+j.elements.legends[1][d-1].getBBox().x+j.elements.legends[1][d-1].getBBox().width}var a=j.gc.circle(g,e);a.attr("stroke",j.options.colors[d]);a.attr("fill",j.options.colors[d]);a.attr("r","5");var h=j.gc.text(g+c[0],e);h.attr(j.options.legendAttr);h.attr("width",this.options.margin[3]);h.attr("text-anchor","start");h.attr("cursor","pointer");h.attr("text",f);h.data("i",d);h.click(function(){var i=this.data("hidden");if(i){j.elements.legends[0][this.data("i")].attr("opacity","1");this.data("hidden",false)}else{j.elements.legends[0][this.data("i")].attr("opacity","0.4");this.data("hidden",true)}j.redraw()});j.elements.legends[0].push(a);j.elements.legends[1].push(h)}},createAxes:function(){var l=this;var b=l.context.getPixY(l.context.getMin());var e=(l.context.options.threshold!=null)?l.context.getPixY(l.context.options.threshold):b;l.elements.axes[0]=[];l.elements.axes[0][1]=[];l.elements.axes[0][2]=[];var g=l.gc.path("");g.attr(l.options.tickYAttr);g.attr("path","M"+this.options.margin[3]+","+this.options.margin[0]+"L"+this.options.margin[3]+","+(this.context.getSize().height-this.options.margin[2]));l.elements.axes[0][0]=g;for(var c=0;c<this.options.tickSize+1;c++){l.elements.axes[0][1][c]=[];var f=this.context.getPixY(this.context.getTickY(c));var k=this.gc.text(10,e,this.context.formatTickY(c));k.attr(this.options.tickYAttr);k.attr("width",this.options.margin[3]);k.attr("text-anchor","start");var d=this.gc.path("");d.attr(l.options.tickYAttr);d.attr("path","M"+this.options.margin[3]+","+e+"L"+(this.options.margin[3]-this.options.tickLength)+","+e);var a=this.gc.path("");a.attr(l.options.gridYAttr);a.attr("path","M"+this.options.margin[3]+","+e+"L"+(this.context.getSize().width-this.options.margin[1])+","+e);a.hide();l.elements.axes[0][1][c][0]=k;l.elements.axes[0][1][c][1]=d;l.elements.axes[0][2][c]=a}l.elements.axes[1]=[];l.elements.axes[1][1]=[];l.elements.axes[1][2]=[];var j=this.gc.path("");j.attr(l.options.tickXAttr);j.attr("path","M"+this.options.margin[3]+","+(this.context.getSize().height-this.options.margin[2])+"L"+(this.context.getSize().width-this.options.margin[1])+","+(this.context.getSize().height-this.options.margin[2]));l.elements.axes[1][0]=g;var h=this.options.margin[3];for(var c=0;c<this.data.categories.length;c++){l.elements.axes[1][1][c]=[];var k=this.gc.text(h,b+3*this.options.tickLength,this.context.getTickX(c));k.attr(this.options.tickXAttr);k.attr("text-anchor","middle");var d=this.gc.path("");d.attr(l.options.tickXAttr);d.attr("path","M"+h+","+b+"L"+this.options.margin[3]+","+(b+this.options.tickLength));var a=this.gc.path("");a.attr(l.options.gridXAttr);a.attr("path","M"+h+","+this.options.margin[0]+"L"+this.options.margin[3]+","+b);a.hide();l.elements.axes[1][1][c][0]=k;l.elements.axes[1][1][c][1]=d;l.elements.axes[1][2][c]=a}},createPlots:function(){var a=this;for(var b=0;b<a.tdata.series.length;b++){var c=a.tdata.series[b];var d=a.gc.path("");d.attr(a.options.lineAttr);d.attr("stroke",a.options.colors[b]);a.elements.series.push(d)}},createDots:function(){var b=this;for(var e=0;e<b.tdata.series.length;e++){var f=b.tdata.series[e];var a=new Array();for(var c=0;c<f.length;c++){var g=b.gc.circle(0,0);g.attr(b.options.dotAttr);g.attr("stroke",b.options.colors[e]);g.attr("fill",b.options.bgAttr.fill);g.data("i",e);g.data("j",c);g.data("data",b.data.series[e]);g.mouseover(function(){this.animate(b.options.dotHoverAttr,b.options.dotTiming);var d=this.getBBox();b.drawTips((d.x+d.x2)/2,(d.y+d.y2)/2,[[this.data("data"),this.data("i"),this.data("j")]])}).mouseout(function(){this.animate(b.options.dotAttr,b.options.dotTiming);b.clearTips()});a.push(g)}b.elements.dots.push(a)}},drawTitle:function(){},drawLegends:function(){},drawAxes:function(){var b=this;var h=b.context.getPixY(b.context.getMin());for(var e=0;e<this.elements.axes[0][1].length;e++){var g=this.context.getPixY(this.context.getTickY(e));var f=this.elements.axes[0][1][e][0];f.animate({y:g},b.options.timing);var d=this.elements.axes[0][1][e][1];d.animate({path:"M"+this.options.margin[3]+","+g+"L"+(this.options.margin[3]-this.options.tickLength)+","+g},b.options.timing);var c=this.elements.axes[0][2][e];if(this.options.showGrid){c.show();c.animate({path:"M"+this.options.margin[3]+","+g+"L"+(this.context.getSize().width-this.options.margin[1])+","+g},b.options.timing)}}for(var e=0;e<this.data.categories.length;e++){var a=this.context.getPixX(this.data.categories.length,e,this.align);var f=this.elements.axes[1][1][e][0];f.animate({x:a},b.options.timing);var d=this.elements.axes[1][1][e][1];d.animate({path:"M"+a+","+h+"L"+a+","+(h+this.options.tickLength)},b.options.timing);var c=this.elements.axes[1][2][e];if(this.options.showGrid){c.show();c.animate({path:"M"+a+","+this.options.margin[0]+"L"+a+","+h},b.options.timing)}}},drawBackground:function(){var a=this;var g=this.context.getPixY(this.context.getMin());var f=a.options.margin[3];var d=a.context.getSize().width-a.options.margin[1];var c=this.gc.rect(0,0,this.context.getSize().width,this.context.getSize().height);c.toBack();c.attr(a.options.bgAttr);if(this.options.showTracker){var e=this.gc.path("");e.attr(a.options.trackerAttr)}var b=[];c.mousemove(function(m){var h=m.offsetX?m.offsetX:m.layerX;var n=m.offsetY?m.offsetY:m.layerY;for(var l=0;l<b.length;l++){for(var k=0;k<b[l].events.length;k++){if(b[l].events[k].name=="mouseout"){b[l].events[k].f.apply(b[l])}}}if(a.options.showTracker){b=a.getDots(0,h);a.clearTips();for(var l=0;l<b.length;l++){for(var k=0;k<b[l].events.length;k++){if(b[l].events[k].name=="mouseover"){b[l].events[k].f.apply(b[l])}}}if(h>=f&&h<=d){if(a.options.showTracker){}}}else{a.clearTips()}})},drawPlots:function(){var a=this;for(var c=0;c<a.tdata.series.length;c++){var g=a.tdata.series[c];var e=a.elements.series[c];var f=a.isHidden(c);for(var b=0;b<g.length;b++){var d=e;if(e.length){d=e[b]}if(f){d.hide()}else{d.show()}a.drawPlot(d,a.tdata.series,c,b)}}},drawPlot:function(b,e,f,d){e=e[f];var o=this;var g=o.context.getThreshold();var k=b.data("pathStart")==undefined?"":b.data("pathStart");var h=b.data("pathEnd")==undefined?"":b.data("pathEnd");var n=e[d][0],l=e[d][1];if(d==0){k="M"+n+","+g;h="M"+n+","+l}else{var a=e[d-1][0],m=e[d-1][1];var c=(n-a)/1.4;k+="S"+(a+c)+","+g+" "+n+","+g;h+="S"+(a+c)+","+l+" "+n+","+l}b.data("pathStart",k);b.data("pathEnd",h);if(d==e.length-1){b.attr("path",k);b.animate({path:h},o.options.timing,o.options.animationType)}},drawDots:function(){var b=this;for(var d=0;d<b.tdata.series.length;d++){var a=b.elements.dots[d];var g=b.tdata.series[d];var f=b.isHidden(d);for(var c=0;c<g.length;c++){var e=a[c];if(f){e.hide()}else{e.show()}b.drawDot(e,b.tdata.series,d,c)}}},drawDot:function(f,g,e,d){g=g[e];var c=this;var b=c.context.getThreshold();var a=g[d][0],h=g[d][1];f.attr("cx",a);f.attr("cy",b);f.animate({cy:h},c.options.timing,c.options.animationType)},drawTips:function(g,f,c){var e=c[0][1];var z=5,k=6,o=this.options.tipAttr.padding;var u=2*o,j=u,v=0;g=Math.round(g)+k;f=Math.round(f);var p=this.gc.path("");p.hide();p.attr(this.options.tipAttr);this.elements.tips.push(p);var a=[];for(var s=0;s<c.length;s++){var b=c[s];var n=this.context.getTip(b[0],b[1],b[2]);var m=this.gc.text(0,f,n);m.hide();m.attr(this.options.tipAttr.textAttr);this.elements.tipTexts.push(m);a.push(m);u+=m.getBBox().height;if(m.getBBox().width>v){v=m.getBBox().width}}j+=v;var d=Math.round(u/2);if(d<z){z=d}var t,A,l=this.context.getFrame();if(g+z+j>l.x+l.width){j=-j;g-=2*k;t=g-z;A=t+j+o}else{t=g+z;A=t+o}var q="M"+g+","+f+"L"+t+","+(f-z)+"L"+t+","+(f-d)+"L"+(t+j)+","+(f-d)+"L"+(t+j)+","+(f+d)+"L"+t+","+(f+d)+"L"+t+","+(f+z)+"L"+g+","+f;p.attr("path",q);var r=this.isHidden(e);for(var s=0;s<a.length;s++){a[s].attr("x",A);if(r){a[s].hide()}else{a[s].show()}}if(r){p.hide()}else{p.show()}},clearTips:function(){for(var a=0;a<this.elements.tips.length;a++){this.elements.tips[a].remove()}for(var a=0;a<this.elements.tipTexts.length;a++){this.elements.tipTexts[a].remove()}this.elements.tips.splice(0);this.elements.tipTexts.splice(0)},getDots:function(g,k,h){var b=[];if(g==0){for(var d=0;d<this.elements.dots.length;d++){var f=this.elements.dots[d];for(var c=0;c<f.length;c++){var a=f[c];var e=a.getBBox();if(k>=e.x&&k<=e.x2){b.push(a)}}}}else{if(g==1){}else{if(g==3){for(var d=0;d<this.elements.dots.length;d++){var f=this.elements.dots[d];for(var c=0;c<f.length;c++){var a=f[c];var e=a.getBBox();if(k>=e.x&&k<=e.x2&&h>=e.y&&h<=e.y2){b.push(a)}}}}}}return b},isHidden:function(a){var b=this.elements.legends[1][a];return b.data("hidden")==undefined?false:b.data("hidden")}};function LineRender(){extend(LineRender.prototype,Render.prototype)}function AreaRender(){extend(AreaRender.prototype,Render.prototype);this.drawPlot=function(c,f,g,e){f=f[g];var q=this;var h=q.context.getThreshold();var l=c.data("pathStart")==undefined?"":c.data("pathStart");var k=c.data("pathEnd")==undefined?"":c.data("pathEnd");var o=f[e][0],m=f[e][1];if(e==0){l="M"+o+","+h;k="M"+o+","+m}else{var b=f[0][0],p=f[0][1];var a=f[e-1][0],n=f[e-1][1];var d=(o-a)/1.4;l+="S"+(a+d)+","+h+" "+o+","+h;k+="S"+(a+d)+","+m+" "+o+","+m;if(e==f.length-1){l+="L"+o+","+h+"L"+o+","+h+"L"+b+","+h+"Z"+b+","+h;k+="L"+o+","+m+"L"+o+","+h+"L"+b+","+h+"Z"+b+","+m}}c.data("pathStart",l);c.data("pathEnd",k);if(e==f.length-1){c.attr("fill",c.attr("stroke"));c.attr("fill-opacity",c.attr("opacity")/2);c.attr("path",l);c.animate({path:k},q.options.timing,q.options.animationType)}}}function ColumnRender(){extend(ColumnRender.prototype,Render.prototype);this.align=1;this.createPlots=function(){var a=this;for(var c=0;c<a.tdata.series.length;c++){a.elements.series[c]=[];var d=a.tdata.series[c];for(var b=0;b<d.length;b++){var e=a.gc.path("");e.attr(a.options.lineAttr);e.attr("stroke",a.options.colors[c]);a.elements.series[c].push(e)}}};this.drawPlot=function(c,h,k,g){c.mouseover(function(){var i=r.elements.dots[this.data("i")][this.data("j")];for(var j in i.events){if(i.events[j].name=="mouseover"){i.events[j].f.apply(i)}}}).mouseout(function(){var i=r.elements.dots[this.data("i")][this.data("j")];for(var j in i.events){if(i.events[j].name=="mouseout"){i.events[j].f.apply(i)}}});c.attr("fill",c.attr("stroke"));c.attr("fill-opacity",c.attr("opacity"));c.data("i",k);c.data("j",g);var r=this;var b=r.context.getThreshold();var p=(r.tdata.series[0][0][0]-r.options.margin[3])*2;var o=p/5;var f=(p-2*o)/r.tdata.series.length;var e=h[k][g][0]-p/2+o+f*k,n=h[k][g][1];var m="M"+e+","+b+"L"+e+","+b+"L"+(e+f)+","+b+"L"+(e+f)+","+b+"Z";var l="M"+e+","+b+"L"+e+","+n+"L"+(e+f)+","+n+"L"+(e+f)+","+b+"Z";if(r.context.options.stacked){f=p-2*o;e=h[k][g][0]-p/2+o;if(k>0){var a=b;for(var q=0;q<k;q++){var d=b-h[q][g][1];a-=d,n-=d}b=a}m="M"+e+","+b+"L"+e+","+b+"L"+(e+f)+","+b+"L"+(e+f)+","+b+"Z";l="M"+e+","+b+"L"+e+","+n+"L"+(e+f)+","+n+"L"+(e+f)+","+b+"Z"}c.attr("path",m);c.animate({path:l},r.options.timing,r.options.animationType)};this.drawDot=function(c,h,k,g){var p=this;var b=p.context.getThreshold();var n=(p.tdata.series[0][0][0]-p.options.margin[3])*2;var m=n/5;var f=(n-2*m)/p.tdata.series.length;var e=h[k][g][0]-n/2+m+f*k+f/2,l=h[k][g][1];if(p.options.stacked){f=n-2*m;e=h[k][g][0];if(k>0){for(var o=0;o<k;o++){var d=b-h[o][g][1];l-=d}}}var a=p.elements.dots[k][g];a.attr("cx",e);a.attr("cy",b);a.animate({cy:l},p.options.timing,p.options.animationType)}}function extend(){var k,c,a,b,g,h,f=arguments[0]||{},e=1,d=arguments.length,j=false;if(typeof f==="boolean"){j=f;f=arguments[1]||{};e=2}if(typeof f!=="object"&&!this.isFunction(f)){f={}}if(d===e){f=this;--e}for(;e<d;e++){if((k=arguments[e])!=null){for(c in k){a=f[c];b=k[c];if(f===b){continue}if(j&&b&&(this.isPlainObject(b)||(g=this.isArray(b)))){if(g){g=false;h=a&&this.isArray(a)?a:[]}else{h=a&&this.isPlainObject(a)?a:{}}f[c]=this.extend(j,h,b)}else{if(b!==undefined){f[c]=b}}}}}return f}function decimal(d,a){var c=parseFloat(d);if(isNaN(c)){return false}var c=Math.round(c*100)/100;var b=c.toString();var e=b.indexOf(".");if(e<0){e=b.length;b+="."}while(b.length<=e+a){b+="0"}return b};