function Chart(a,c,d,b){this.options={title:"",margin:[60,20,40,80],showTracker:true,showGrid:true,stacked:false,threshold:null,tickSize:10,tickLength:5,tickInterval:null,tickFixed:2,colors:[["#1ba5b2"],["#cd2642"],["#84ad29"]],animationType:"<",timing:500,dotTiming:100,formatX:null,formatY:null,getY:null,getTickY:null,formatTickY:null,getTickX:null,formatTickX:null,getTip:null,titleAttr:{"font-weight":"bold","font-size":14},bgAttr:{fill:"#ffffff","stroke-width":0},trackerAttr:{"stroke-width":1,opacity:0.5,fill:"#666666"},gridXAttr:{"stroke-width":1,opacity:0.1,fill:"#666666",},gridYAttr:{"stroke-width":1,opacity:0.1,fill:"#666666",},tickYAttr:{"font-size":12,fill:"#666666",opacity:0.8},tickXAttr:{"font-size":12,fill:"#666666",opacity:0.8},tipAttr:{"stroke-width":2,opacity:0.8,fill:"#f4f4f4",stroke:"#666666",padding:10,textAttr:{"font-size":12,fill:"#000000",opacity:1,"text-anchor":"start"}},lineAttr:{"stroke-width":3,opacity:0.9},lineHoverAttr:{"stroke-width":4,opacity:0.9},dotAttr:{"stroke-width":2,r:4,opacity:1},dotHoverAttr:{"stroke-width":2,r:5,opacity:1},legendAttr:{}};return this.init(a,c,d,b)}Chart.prototype={init:function(a,c,d,b){this.elements={series:[],ticks:[[[],[]],[[],[]]],dots:[]};this.setContainer(a);this.setOptions(b);this.setType(c);this.setData(d);this.setSize({width:this.options.width,height:this.options.height});this.setFrame();this.setMax();this.setMin();this.gc=Raphael(this.container,this.options.width,this.options.height);return this},setContainer:function(a){this.container=a},setOptions:function(a){extend(this.options,a);if(this.options.width==undefined){this.options.width=this.container.clientWidth}if(this.options.height==undefined){this.options.height=this.container.clientHeight}},draw:function(){this.render.run(this)},setSize:function(a){this.size=a},getSize:function(){return this.size},setGC:function(a){this.gc=a},getGC:function(){return this.gc},setType:function(type){this.type=type;eval("var Render = "+type+"Render");this.setRender(new Render())},setRender:function(a){this.render=a},setData:function(a){this.data=a},setFrame:function(){var a=this.getSize();this.frame={x:this.options.margin[3],y:this.options.margin[0],width:(a.width-this.options.margin[1]-this.options.margin[3]),height:(a.height-this.options.margin[0]-this.options.margin[2])}},getFrame:function(){return this.frame},setMax:function(){var a;if(this.options.stacked){for(var c=0;c<this.data.series[0].length;c++){var b;for(var d=0;d<this.data.series.length;d++){var e=this.getY(this.data.series[d],c);if(d==0){b=e}else{b+=e}}if(c==0){a=b}else{if(b>a){a=b}}}}else{for(var d=0;d<this.data.series.length;d++){for(var c=0;c<this.data.series[d].length;c++){var e=this.getY(this.data.series[d],c);if(d==0&&c==0){a=e}else{if(e>a){a=e}}}}}this.max=a},getMax:function(){return this.options.getMax!=undefined?this.options.getMax():this.max},setMin:function(){var c;for(var b=0;b<this.data.series.length;b++){for(var a=0;a<this.data.series[b].length;a++){var d=this.getY(this.data.series[b],a);if(b==0&&a==0){c=d}else{if(d<c){c=d}}}}return this.min=c},getMin:function(){return this.options.getMin!=undefined?this.options.getMin():this.min},getPixX:function(f,e,a){if(a==undefined){a=0}var g=this.getFrame(),b=g.width,c=b/(f-1),d=g.x+e*c;if(a==1){c=b/(f);d=g.x+e*c+c/2}return d},getPixY:function(a){return this.getFrame().height*(1-(a-this.getMin())/(this.getMax()-this.getMin()))+this.getFrame().y},getY:function(b,a){return this.options.getY!=undefined?this.options.getY(b,a):b[a]},getTickY:function(d){var a=this.getMax(),c=this.getMin();var b=(a-c)/this.options.tickSize;var e=decimal(c+b*d,this.options.tickFixed);return this.options.getTickY!=undefined?this.options.getTickY(e,d):e},formatTickY:function(a){return this.options.formatTickY!=undefined?this.options.formatTickY(this.getTickY(a),a):this.getTickY(a)},getTickX:function(a){return this.options.getTickX!=undefined?this.options.getTickX(this.data.categories[a],a):this.data.categories[a]},formatTickX:function(a){return this.options.formatTickX!=undefined?this.options.formatTickX(this.getTickX(a),a):this.getTickX(a)},getTip:function(c,b,a){return this.options.getTip!=undefined?this.options.getTip(c,b):this.data.legends[b]+":"+c[a]},getThreshold:function(){return(this.options.threshold!=null)?this.getPixY(this.options.threshold):this.getPixY(this.getMin())}};function Render(){}Render.prototype={run:function(a){this.context=a;this.data=this.context.data;this.options=this.context.options;this.gc=this.context.getGC();this.init();this.build();this.create();this.draw()},init:function(){this.clear();this.tdata={};this.elements={axes:[],series:[],dots:[],tips:[],tipTexts:[],legends:[[],[]]}},clear:function(){this.gc.clear()},build:function(){this.buildPlotsData()},create:function(){this.createTitle();this.createLegends();this.createAxes();this.createPlots();this.createDots()},draw:function(){var a=this;a.drawTitle();a.drawLegends();a.drawAxes();a.drawBackground();if(!this.isRedraw){setTimeout(function(){a.drawPlots();a.drawDots()},a.options.timing)}else{a.drawPlots();a.drawDots()}},redraw:function(){this.isRedraw=true;this.draw()},buildPlotsData:function(){var b=this;this.tdata.series=[];for(var d=0;d<b.data.series.length;d++){this.tdata.series[d]=[];var e=b.data.series[d];for(var c=0;c<e.length;c++){var a=b.context.getPixX(e.length,c,this.align);var f=b.context.getPixY(b.context.getY(e,c));this.tdata.series[d][c]=[a,f]}}},createTitle:function(){var b=this;var d=b.context.getFrame();var a=d.x,e=10;var c=b.gc.text(a,e);c.attr(b.options.titleAttr);c.attr("text-anchor","start");c.attr("text",b.options.title)},createLegends:function(){var j=this;var b=j.context.getFrame();var g=b.x,e=b.y-20,c=[10,15];for(var d=0;d<j.data.legends.length;d++){var f=j.data.legends[d];if(d>0){g=c[1]+j.elements.legends[1][d-1].getBBox().x+j.elements.legends[1][d-1].getBBox().width}var a=j.gc.circle(g,e);a.attr("stroke",j.options.colors[d]);a.attr("fill",j.options.colors[d]);a.attr("r","5");var h=j.gc.text(g+c[0],e);h.attr(j.options.legendAttr);h.attr("width",b.x);h.attr("text-anchor","start");h.attr("cursor","pointer");h.attr("text",f);h.data("i",d);h.click(function(){var i=this.data("hidden");if(i){j.elements.legends[0][this.data("i")].attr("opacity","1");this.data("hidden",false)}else{j.elements.legends[0][this.data("i")].attr("opacity","0.4");this.data("hidden",true)}j.redraw()});j.elements.legends[0].push(a);j.elements.legends[1].push(h)}},createAxes:function(){var l=this;var c=l.context.getPixY(l.context.getMin());var f=(l.context.options.threshold!=null)?l.context.getPixY(l.context.options.threshold):c;var b=this.context.getFrame();l.elements.axes[0]=[];l.elements.axes[0][1]=[];l.elements.axes[0][2]=[];var h=l.gc.path("");h.attr(l.options.tickYAttr);h.attr("path","M"+b.x+","+b.y+"L"+b.x+","+(b.y+b.height));l.elements.axes[0][0]=h;for(var d=0;d<this.options.tickSize+1;d++){l.elements.axes[0][1][d]=[];var g=this.context.getPixY(this.context.getTickY(d));var k=this.gc.text(10,f,this.context.formatTickY(d));k.attr(this.options.tickYAttr);k.attr("width",b.x);k.attr("text-anchor","start");var e=this.gc.path("");e.attr(l.options.tickYAttr);e.attr("path","M"+b.x+","+f+"L"+(b.x-this.options.tickLength)+","+f);var a=this.gc.path("");a.attr(l.options.gridYAttr);a.attr("path","M"+b.x+","+f+"L"+(b.width+b.x)+","+f);a.hide();l.elements.axes[0][1][d][0]=k;l.elements.axes[0][1][d][1]=e;l.elements.axes[0][2][d]=a}l.elements.axes[1]=[],l.elements.axes[1][1]=[],l.elements.axes[1][2]=[];var j=this.gc.path("");j.attr(l.options.tickXAttr);j.attr("path","M"+b.x+","+(b.y+b.height)+"L"+(b.x+b.width)+","+(b.y+b.height));l.elements.axes[1][0]=h;for(var d=0;d<this.data.categories.length;d++){l.elements.axes[1][1][d]=[];var k=this.gc.text(b.x,c+3*this.options.tickLength,this.context.getTickX(d));k.attr(this.options.tickXAttr);k.attr("text-anchor","middle");var e=this.gc.path("");e.attr(l.options.tickXAttr);e.attr("path","M"+b.x+","+c+"L"+b.x+","+(c+this.options.tickLength));var a=this.gc.path("");a.attr(l.options.gridXAttr);a.attr("path","M"+b.x+","+b.y+"L"+b.x+","+c);a.hide();l.elements.axes[1][1][d][0]=k;l.elements.axes[1][1][d][1]=e;l.elements.axes[1][2][d]=a}},createPlots:function(){var a=this;for(var b=0;b<a.tdata.series.length;b++){var c=a.tdata.series[b];var d=a.gc.path("");d.attr(a.options.lineAttr);d.attr("stroke",a.options.colors[b]);a.elements.series.push(d)}},createDots:function(){var b=this;for(var e=0;e<b.tdata.series.length;e++){var f=b.tdata.series[e];var a=new Array();for(var c=0;c<f.length;c++){var g=b.gc.circle(0,0);g.attr(b.options.dotAttr);g.attr("stroke",b.options.bgAttr.fill);g.attr("fill",b.options.colors[e]);g.data("i",e);g.data("j",c);g.data("data",b.data.series[e]);g.mouseover(function(){this.animate(b.options.dotHoverAttr,b.options.dotTiming);var d=this.getBBox();b.drawTips((d.x+d.x2)/2,(d.y+d.y2)/2,[[this.data("data"),this.data("i"),this.data("j")]])}).mouseout(function(){this.animate(b.options.dotAttr,b.options.dotTiming);b.clearTips()});a.push(g)}b.elements.dots.push(a)}},drawTitle:function(){},drawLegends:function(){},drawAxes:function(){var j=this;var c=j.context.getPixY(j.context.getMin());var b=this.context.getFrame();for(var d=0;d<this.elements.axes[0][1].length;d++){var f=this.context.getPixY(this.context.getTickY(d));var h=this.elements.axes[0][1][d][0];h.animate({y:f},j.options.timing);var e=this.elements.axes[0][1][d][1];e.animate({path:"M"+b.x+","+f+"L"+(b.x-this.options.tickLength)+","+f},j.options.timing);var a=this.elements.axes[0][2][d];if(this.options.showGrid){a.show();a.animate({path:"M"+b.x+","+f+"L"+(b.x+b.width)+","+f},j.options.timing)}}for(var d=0;d<this.data.categories.length;d++){var g=this.context.getPixX(this.data.categories.length,d,this.align);var h=this.elements.axes[1][1][d][0];h.animate({x:g},j.options.timing);var e=this.elements.axes[1][1][d][1];e.animate({path:"M"+g+","+c+"L"+g+","+(c+this.options.tickLength)},j.options.timing);var a=this.elements.axes[1][2][d];if(this.options.showGrid){a.show();a.animate({path:"M"+g+","+b.y+"L"+g+","+c},j.options.timing)}}},drawBackground:function(){var a=this;var f=this.context.getPixY(this.context.getMin());var e=this.context.getFrame();var c=this.gc.rect(0,0,this.context.getSize().width,this.context.getSize().height);c.toBack();c.attr(a.options.bgAttr);if(this.options.showTracker){var d=this.gc.path("");d.attr(a.options.trackerAttr)}var b=[];c.mousemove(function(l){var g=l.offsetX?l.offsetX:l.layerX;var m=l.offsetY?l.offsetY:l.layerY;for(var k=0;k<b.length;k++){for(var h=0;h<b[k].events.length;h++){if(b[k].events[h].name=="mouseout"){b[k].events[h].f.apply(b[k])}}}if(a.options.showTracker){b=a.getDots(0,g);a.clearTips();for(var k=0;k<b.length;k++){for(var h=0;h<b[k].events.length;h++){if(b[k].events[h].name=="mouseover"){b[k].events[h].f.apply(b[k])}}}if(g>=e.x&&g<=e.x+e.width){if(a.options.showTracker){}}}else{a.clearTips()}})},drawPlots:function(){var a=this;for(var c=0;c<a.tdata.series.length;c++){var g=a.tdata.series[c];var e=a.elements.series[c];var f=a.isHidden(c);for(var b=0;b<g.length;b++){var d=e;if(e.length){d=e[b]}if(f){d.hide()}else{d.show()}a.drawPlot(d,a.tdata.series,c,b)}}},drawPlot:function(b,e,f,d){var o=this,e=e[f],n=e[d][0],l=e[d][1];var g=o.context.getThreshold();var k=b.data("pathStart")==undefined?"":b.data("pathStart");var h=b.data("pathEnd")==undefined?"":b.data("pathEnd");if(d==0){k="M"+n+","+g;h="M"+n+","+l}else{var a=e[d-1][0],m=e[d-1][1];var c=(n-a)/1.5;k+="S"+(a+c)+","+g+" "+n+","+g;h+="S"+(a+c)+","+l+" "+n+","+l}b.data("pathStart",k);b.data("pathEnd",h);if(d==e.length-1){b.attr("path",k);b.animate({path:h},o.options.timing,o.options.animationType)}},drawDots:function(){var b=this;for(var d=0;d<b.tdata.series.length;d++){var a=b.elements.dots[d];var g=b.tdata.series[d];var f=b.isHidden(d);for(var c=0;c<g.length;c++){var e=a[c];if(f){e.hide()}else{e.show()}b.drawDot(e,b.tdata.series,d,c)}}},drawDot:function(f,g,e,d){var c=this,g=g[e],b=g[d][0],h=g[d][1];var a=c.context.getThreshold();f.attr("cx",b);f.attr("cy",a);f.animate({cy:h},c.options.timing,c.options.animationType)},drawTips:function(j,g,e){var f=e[0][1];var z=5,l=7,c=ycorner=10,p=this.options.tipAttr.padding;var u=2*p,k=u,v=0;j=Math.round(j)+l;g=Math.round(g);var q=this.gc.path("");q.hide();q.attr(this.options.tipAttr);this.elements.tips.push(q);var a=[];for(var s=0;s<e.length;s++){var b=e[s];var o=this.context.getTip(b[0],b[1],b[2]);var n=this.gc.text(0,g,o);n.hide();n.attr(this.options.tipAttr.textAttr);this.elements.tipTexts.push(n);a.push(n);u+=n.getBBox().height;if(n.getBBox().width>v){v=n.getBBox().width}}k+=v;var d=Math.round(u/2);if(d<z){z=d}if(d<z+ycorner){c=ycorner=d-z}var t,A,m=this.context.getFrame();if(j+z+k>m.x+m.width){k=-k;j-=2*l;t=j-z;A=t+k+p;c=-c}else{t=j+z;A=t+p}pathString="M"+j+","+g+"L"+t+","+(g-z);pathString+="L"+t+","+(g-d+ycorner);pathString+="C"+t+","+(g-d)+" "+t+","+(g-d)+" "+(t+c)+","+(g-d);pathString+="L"+(t+k-c)+","+(g-d);pathString+="C"+(t+k)+","+(g-d)+" "+(t+k)+","+(g-d)+" "+(t+k)+","+(g-d+ycorner);pathString+="L"+(t+k)+","+(g+d-ycorner);pathString+="C"+(t+k)+","+(g+d)+" "+(t+k)+","+(g+d)+" "+(t+k-c)+","+(g+d);pathString+="L"+(t+c)+","+(g+d);pathString+="C"+t+","+(g+d)+" "+t+","+(g+d)+" "+t+","+(g+d-ycorner);pathString+="L"+t+","+(g+z);pathString+="L"+j+","+g;q.attr("path",pathString);var r=this.isHidden(f);for(var s=0;s<a.length;s++){a[s].attr("x",A);if(r){a[s].hide()}else{a[s].show()}}if(r){q.hide()}else{q.show()}},clearTips:function(){for(var a=0;a<this.elements.tips.length;a++){this.elements.tips[a].remove()}for(var a=0;a<this.elements.tipTexts.length;a++){this.elements.tipTexts[a].remove()}this.elements.tips.splice(0);this.elements.tipTexts.splice(0)},getDots:function(g,k,h){var b=[];if(g==0){for(var d=0;d<this.elements.dots.length;d++){var f=this.elements.dots[d];for(var c=0;c<f.length;c++){var a=f[c];var e=a.getBBox();if(k>=e.x&&k<=e.x2){b.push(a)}}}}else{if(g==1){}else{if(g==3){for(var d=0;d<this.elements.dots.length;d++){var f=this.elements.dots[d];for(var c=0;c<f.length;c++){var a=f[c];var e=a.getBBox();if(k>=e.x&&k<=e.x2&&h>=e.y&&h<=e.y2){b.push(a)}}}}}}return b},isHidden:function(a){var b=this.elements.legends[1][a];return b.data("hidden")==undefined?false:b.data("hidden")}};function LineRender(){extend(LineRender.prototype,Render.prototype)}function AreaRender(){extend(AreaRender.prototype,Render.prototype);this.drawPlot=function(c,f,g,e){f=f[g];var q=this,o=f[e][0],m=f[e][1];var h=q.context.getThreshold();var l=c.data("pathStart")==undefined?"":c.data("pathStart");var k=c.data("pathEnd")==undefined?"":c.data("pathEnd");if(e==0){l="M"+o+","+h;k="M"+o+","+m}else{var b=f[0][0],p=f[0][1];var a=f[e-1][0],n=f[e-1][1];var d=(o-a)/1.4;l+="S"+(a+d)+","+h+" "+o+","+h;k+="S"+(a+d)+","+m+" "+o+","+m;if(e==f.length-1){l+="L"+o+","+h+"L"+o+","+h+"L"+b+","+h+"Z"+b+","+h;k+="L"+o+","+m+"L"+o+","+h+"L"+b+","+h+"Z"+b+","+m}}c.data("pathStart",l);c.data("pathEnd",k);if(e==f.length-1){c.attr("fill",c.attr("stroke"));c.attr("fill-opacity",c.attr("opacity")/2);c.attr("path",l);c.animate({path:k},q.options.timing,q.options.animationType)}}}function ColumnRender(){extend(ColumnRender.prototype,Render.prototype);this.align=1;this.createPlots=function(){var a=this;for(var c=0;c<a.tdata.series.length;c++){a.elements.series[c]=[];var d=a.tdata.series[c];for(var b=0;b<d.length;b++){var e=a.gc.path("");e.attr(a.options.lineAttr);e.attr("stroke",a.options.colors[c]);a.elements.series[c].push(e)}}};this.drawPlot=function(d,k,l,h){d.mouseover(function(){var i=s.elements.dots[this.data("i")][this.data("j")];for(var j in i.events){if(i.events[j].name=="mouseover"){i.events[j].f.apply(i)}}}).mouseout(function(){var i=s.elements.dots[this.data("i")][this.data("j")];for(var j in i.events){if(i.events[j].name=="mouseout"){i.events[j].f.apply(i)}}});d.attr("fill",d.attr("stroke"));d.attr("fill-opacity",d.attr("opacity"));d.data("i",l);d.data("j",h);var s=this;var c=this.context.getFrame();var b=s.context.getThreshold();var q=(s.tdata.series[0][0][0]-c.x)*2;var p=q/5;var g=(q-2*p)/s.tdata.series.length;var f=k[l][h][0]-q/2+p+g*l,o=k[l][h][1];var n="M"+f+","+b+"L"+f+","+b+"L"+(f+g)+","+b+"L"+(f+g)+","+b+"Z";var m="M"+f+","+b+"L"+f+","+o+"L"+(f+g)+","+o+"L"+(f+g)+","+b+"Z";if(s.context.options.stacked){g=q-2*p;f=k[l][h][0]-q/2+p;if(l>0){var a=b;for(var r=0;r<l;r++){var e=b-k[r][h][1];a-=e,o-=e}b=a}n="M"+f+","+b+"L"+f+","+b+"L"+(f+g)+","+b+"L"+(f+g)+","+b+"Z";m="M"+f+","+b+"L"+f+","+o+"L"+(f+g)+","+o+"L"+(f+g)+","+b+"Z"}d.attr("path",n);d.animate({path:m},s.options.timing,s.options.animationType)};this.drawDot=function(d,k,l,h){var q=this;var c=this.context.getFrame();var b=q.context.getThreshold();var o=(q.tdata.series[0][0][0]-c.x)*2;var n=o/5;var g=(o-2*n)/q.tdata.series.length;var f=k[l][h][0]-o/2+n+g*l+g/2,m=k[l][h][1];if(q.options.stacked){g=o-2*n;f=k[l][h][0];if(l>0){for(var p=0;p<l;p++){var e=b-k[p][h][1];m-=e}}}var a=q.elements.dots[l][h];a.attr("cx",f);a.attr("cy",b);a.animate({cy:m},q.options.timing,q.options.animationType)}}function extend(){var k,c,a,b,g,h,f=arguments[0]||{},e=1,d=arguments.length,j=false;if(typeof f==="boolean"){j=f,f=arguments[1]||{},e=2}if(typeof f!=="object"&&!this.isFunction(f)){f={}}if(d===e){f=this,--e}for(;e<d;e++){if((k=arguments[e])!=null){for(c in k){a=f[c],b=k[c];if(f===b){continue}if(j&&b&&(this.isPlainObject(b)||(g=this.isArray(b)))){if(g){g=false,h=a&&this.isArray(a)?a:[]}else{h=a&&this.isPlainObject(a)?a:{}}f[c]=this.extend(j,h,b)}else{if(b!==undefined){f[c]=b}}}}}return f}function decimal(d,a){var c=parseFloat(d);if(isNaN(c)){return false}var c=Math.round(c*100)/100,b=c.toString(),e=b.indexOf(".");if(e<0){e=b.length,b+="."}while(b.length<=e+a){b+="0"}return b};