var _options={width:600,height:400,margin:[20,20,40,80],bgAttr:{fill:"#ffffff","stroke-width":0},threshold:0,formatX:null,formatY:null,getX:null,getY:null,showTracker:true,trackerAttr:{"stroke-width":1,opacity:0.5,fill:"#666666"},showGrid:true,gridXAttr:{"stroke-width":1,opacity:0.1,fill:"#666666",},gridYAttr:{"stroke-width":1,opacity:0.1,fill:"#666666",},tickSize:10,tickLength:5,tickInterval:null,tickFixed:2,tickYAttr:{"font-size":12,fill:"#666666",opacity:0.8},tickXAttr:{"font-size":12,fill:"#666666",opacity:0.8},getTickY:null,formatTickY:null,getTickX:null,formatTickX:null,tipAttr:{"stroke-width":2,opacity:0.8,fill:"#f4f4f4",stroke:"#666666",padding:5,textAttr:{"font-size":12,fill:"#000000",opacity:1,"text-anchor":"start"}},getTipText:null,lineAttr:{"stroke-width":3,opacity:0.9},lineHoverAttr:{"stroke-width":4,opacity:0.9},dotAttr:{"stroke-width":2,r:3,opacity:1},dotHoverAttr:{"stroke-width":2,r:4,opacity:1},colors:[["#075697"],["#970707"],["#079741"]],timing:500,dotTiming:100};function Chart(a,c,e,b){extend(_options,b);this.options=_options;var d=Raphael(a,this.options.width,this.options.height);this.setGC(d);this.setType(c);this.setData(e);this.init()}Chart.prototype={init:function(){this.elements={series:[],ticks:[[[],[]],[[],[]]],dots:[]};this.setSize({width:this.options.width,height:this.options.height});this.setFrame();this.setMax();this.setMin()},draw:function(){this.render.run(this)},setSize:function(a){this.size=a},getSize:function(){return this.size},setGC:function(a){this.gc=a},getGC:function(){return this.gc},setType:function(type){this.type=type;eval("var Render = "+type+"Render");var render=new Render();this.setRender(render)},setRender:function(a){this.render=a},setData:function(a){this.data=a},setFrame:function(){var a=this.getSize();var b={};b.x=this.options.margin[3];b.y=this.options.margin[0];b.width=a.width-this.options.margin[1]-this.options.margin[3];b.height=a.height-this.options.margin[0]-this.options.margin[2];this.frame=b},getFrame:function(){return this.frame},setMax:function(){var a;for(var c=0;c<this.data.series.length;c++){for(var b=0;b<this.data.series[c].length;b++){var d=this.getY(this.data.series[c],b);if(c==0&&b==0){a=d}else{if(d>a){a=d}}}}this.max=a;return a},getMax:function(){return this.max},setMin:function(){var c;for(var b=0;b<this.data.series.length;b++){for(var a=0;a<this.data.series[b].length;a++){var d=this.getY(this.data.series[b],a);if(b==0&&a==0){c=d}else{if(d<c){c=d}}}}this.min=c;return c},getMin:function(){return this.min},getPixX:function(c,b){var a=this.getSize().width-this.options.margin[1]-this.options.margin[3];return this.options.margin[3]+b*a/(c-1)},getPixY:function(d){var c=this.getSize().height-this.options.margin[0]-this.options.margin[2];var a=this.getMax();var b=this.getMin();return c*(1-(d-b)/(a-b))+this.options.margin[0]},getY:function(b,a){if(this.options.getY){return this.options.getY(b,a)}return b[a]["y"]},getX:function(b,a){if(this.options.getX){return this.options.getX(b,a)}return b[a]["x"]},getTickY:function(d){var a=this.getMax();var c=this.getMin();var b=(a-c)/this.options.tickSize;var e=decimal(c+b*d,this.options.tickFixed);if(this.options.getTickY){return this.options.getTickY(e,d)}else{return e}},formatTickY:function(a){var b=this.getTickY(a);if(this.options.formatTickY){return this.options.formatTickY(b,a)}else{return b}},getTickX:function(a){var b=this.data.categories[a];if(this.options.getTickX){return this.options.getTickX(b,a)}else{return b}},formatTickX:function(a){var b=this.getTickX(a);if(this.options.formatTickX){return this.options.formatTickX(b,a)}else{return b}},getTipText:function(b,a){if(this.options.getTipText){return this.options.getTipText(b,a)}else{return b[a]["y"]+""}}};function Render(){}Render.prototype={run:function(a){this.context=a;this.data=this.context.data;this.options=this.context.options;this.gc=this.context.getGC();this.init();this.build();this.draw()},init:function(){this.tdata={};this.elements={axes:[],series:[],dots:[],tips:[],tipTexts:[]}},clear:function(){this.gc.clear()},build:function(){this.buildData();this.buildAxes();this.buildPlots()},buildData:function(){var b=this;this.tdata.series=[];for(var d=0;d<b.data.series.length;d++){this.tdata.series[d]=[];var e=b.data.series[d];for(var c=0;c<e.length;c++){var a=b.context.getPixX(e.length,c);var f=b.context.getPixY(b.context.getY(e,c));this.tdata.series[d][c]=[a,f]}}},buildAxes:function(){var k=this;var b=k.context.getPixY(this.context.getMin());k.elements.axes[0]=[];k.elements.axes[0][1]=[];k.elements.axes[0][2]=[];var f=k.gc.path("");f.attr(k.options.tickYAttr);f.attr("path","M"+this.options.margin[3]+","+this.options.margin[0]+"L"+this.options.margin[3]+","+(this.context.getSize().height-this.options.margin[2]));k.elements.axes[0][0]=f;for(var c=0;c<this.options.tickSize+1;c++){k.elements.axes[0][1][c]=[];var e=this.context.getPixY(this.context.getTickY(c));var j=this.gc.text(10,b,this.context.formatTickY(c));j.attr(this.options.tickYAttr);j.attr("width",this.options.margin[3]);j.attr("text-anchor","start");var d=this.gc.path("");d.attr(k.options.tickYAttr);d.attr("path","M"+this.options.margin[3]+","+b+"L"+(this.options.margin[3]-this.options.tickLength)+","+b);var a=this.gc.path("");a.attr(k.options.gridYAttr);a.attr("path","M"+this.options.margin[3]+","+b+"L"+(this.context.getSize().width-this.options.margin[1])+","+b);a.hide();k.elements.axes[0][1][c][0]=j;k.elements.axes[0][1][c][1]=d;k.elements.axes[0][2][c]=a}k.elements.axes[1]=[];k.elements.axes[1][1]=[];k.elements.axes[1][2]=[];var h=this.gc.path("");h.attr(k.options.tickXAttr);h.attr("path","M"+this.options.margin[3]+","+(this.context.getSize().height-this.options.margin[2])+"L"+(this.context.getSize().width-this.options.margin[1])+","+(this.context.getSize().height-this.options.margin[2]));k.elements.axes[1][0]=f;for(var c=0;c<this.data.categories.length;c++){k.elements.axes[1][1][c]=[];var g=this.context.getPixX(this.data.categories.length,c);var j=this.gc.text(this.options.margin[3],b+3*this.options.tickLength,this.context.getTickX(c));j.attr(this.options.tickXAttr);j.attr("text-anchor","middle");var d=this.gc.path("");d.attr(k.options.tickXAttr);d.attr("path","M"+this.options.margin[3]+","+b+"L"+this.options.margin[3]+","+(b+this.options.tickLength));var a=this.gc.path("");a.attr(k.options.gridXAttr);a.attr("path","M"+this.options.margin[3]+","+this.options.margin[0]+"L"+this.options.margin[3]+","+b);a.hide();k.elements.axes[1][1][c][0]=j;k.elements.axes[1][1][c][1]=d;k.elements.axes[1][2][c]=a}},buildPlots:function(){var p=this;var e=p.context.getPixY(p.context.getMin());for(var k=0;k<p.tdata.series.length;k++){var h=p.tdata.series[k];var q=p.gc.path("");q.attr(p.options.lineAttr);q.attr("stroke",p.options.colors[k]);var f;for(var g=0;g<h.length;g++){var o=h[g][0],m=h[g][1];if(g==0){f="M"+o+","+e}else{var b=h[g-1][0],n=h[g-1][1];var c=(o-b)/1.4;f+="S"+(b+c)+","+e+" "+o+","+e}}q.attr("path",f);p.elements.series.push(q)}for(var k=0;k<p.tdata.series.length;k++){var h=p.tdata.series[k];var a=new Array();for(var g=0;g<h.length;g++){var o=h[g][0],m=h[g][1];var l=p.gc.circle(0,0);l.attr(p.options.dotAttr);l.attr("stroke",p.options.bgAttr.fill);l.attr("fill",p.options.colors[k]);l.attr("data",p.context.getY(h,g));l.attr("cx",o);l.attr("cy",e);l.data("index",g);l.data("data",p.data.series[k]);l.mouseover(function(){this.animate(p.options.dotHoverAttr,p.options.dotTiming);var d=this.getBBox();p.drawTips((d.x+d.x2)/2,(d.y+d.y2)/2,[p.context.getTipText(this.data("data"),this.data("index"))])}).mouseout(function(){this.animate(p.options.dotAttr,p.options.dotTiming)});a.push(l)}p.elements.dots.push(a)}},draw:function(){var a=this;a.drawAxes();a.drawBackground();setTimeout(function(){a.drawPlots()},a.options.timing)},drawAxes:function(){var b=this;var h=b.context.getPixY(b.context.getMin());for(var e=0;e<this.elements.axes[0][1].length;e++){var g=this.context.getPixY(this.context.getTickY(e));var f=this.elements.axes[0][1][e][0];f.animate({y:g},b.options.timing);var d=this.elements.axes[0][1][e][1];d.animate({path:"M"+this.options.margin[3]+","+g+"L"+(this.options.margin[3]-this.options.tickLength)+","+g},b.options.timing);var c=this.elements.axes[0][2][e];if(this.options.showGrid){c.show();c.animate({path:"M"+this.options.margin[3]+","+g+"L"+(this.context.getSize().width-this.options.margin[1])+","+g},b.options.timing)}}for(var e=0;e<this.data.categories.length;e++){var a=this.context.getPixX(this.data.categories.length,e);var f=this.elements.axes[1][1][e][0];f.animate({x:a},b.options.timing);var d=this.elements.axes[1][1][e][1];d.animate({path:"M"+a+","+h+"L"+a+","+(h+this.options.tickLength)},b.options.timing);var c=this.elements.axes[1][2][e];if(this.options.showGrid){c.show();c.animate({path:"M"+a+","+this.options.margin[0]+"L"+a+","+h},b.options.timing)}}},drawBackground:function(){var a=this;var g=this.context.getPixY(this.context.getMin());var f=a.options.margin[3];var d=a.context.getSize().width-a.options.margin[1];var c=this.gc.rect(0,0,this.context.getSize().width,this.context.getSize().height);c.toBack();c.attr(a.options.bgAttr);if(this.options.showTracker){var e=this.gc.path("");e.attr(a.options.trackerAttr)}var b=[];c.mousemove(function(m){var h=m.offsetX?m.offsetX:m.layerX;var n=m.offsetY?m.offsetY:m.layerY;for(var l=0;l<b.length;l++){for(var k=0;k<b[l].events.length;k++){if(b[l].events[k].name=="mouseout"){b[l].events[k].f.apply(b[l])}}}if(a.options.showTracker){b=a.getDots(0,h);a.clearTips();for(var l=0;l<b.length;l++){for(var k=0;k<b[l].events.length;k++){if(b[l].events[k].name=="mouseover"){b[l].events[k].f.apply(b[l])}}}if(h>=f&&h<=d){if(a.options.showTracker){}}}else{a.clearTips()}})},drawPlots:function(){var s=this;var e=s.context.getPixY(s.context.getMin());var r=this.context.getSize().width;var m=this.context.getSize().height;for(var l=0;l<s.tdata.series.length;l++){var t=s.elements.series[l];var a=s.elements.dots[l];var k=s.tdata.series[l];var f;for(var g=0;g<k.length;g++){var q=k[g][0],o=k[g][1];if(g==0){f="M"+q+","+o}else{var b=k[g-1][0],p=k[g-1][1];var c=(q-b)/1.4;f+="S"+(b+c)+","+o+" "+q+","+o}}t.animate({path:f},s.options.timing,"<")}for(var l=0;l<s.tdata.series.length;l++){var a=s.elements.dots[l];var k=s.tdata.series[l];for(var g=0;g<k.length;g++){var n=a[g];var o=k[g][1];n.animate({cy:o},s.options.timing,"<")}}},drawTips:function(e,d,b){var s=5,g=6,l=this.options.tipAttr.padding;var p=2*l,f=p,r=0;e=Math.round(e)+g;d=Math.round(d);var m=this.gc.path("");m.hide();m.attr(this.options.tipAttr);this.elements.tips.push(m);var a=[];for(var o=0;o<b.length;o++){var j=this.gc.text(0,d,b[o]);j.hide();j.attr(this.options.tipAttr.textAttr);this.elements.tipTexts.push(j);a.push(j);p+=j.getBBox().height;if(j.getBBox().width>r){r=j.getBBox().width}}f+=r;var c=Math.round(p/2);if(c<s){s=c}var q,t,k=this.context.getFrame();if(e+s+f>k.x+k.width){f=-f;e-=2*g;q=e-s;t=q+f+l}else{q=e+s;t=q+l}for(var o=0;o<a.length;o++){a[o].attr("x",t);a[o].show()}var n="M"+e+","+d+"L"+q+","+(d-s)+"L"+q+","+(d-c)+"L"+(q+f)+","+(d-c)+"L"+(q+f)+","+(d+c)+"L"+q+","+(d+c)+"L"+q+","+(d+s)+"L"+e+","+d;m.attr("path",n);m.show()},getDots:function(g,k,h){var b=[];if(g==0){for(var d=0;d<this.elements.dots.length;d++){var f=this.elements.dots[d];for(var c=0;c<f.length;c++){var a=f[c];var e=a.getBBox();if(k>=e.x&&k<=e.x2){b.push(a)}}}}else{if(g==1){}else{if(g==3){for(var d=0;d<this.elements.dots.length;d++){var f=this.elements.dots[d];for(var c=0;c<f.length;c++){var a=f[c];var e=a.getBBox();if(k>=e.x&&k<=e.x2&&h>=e.y&&h<=e.y2){b.push(a)}}}}}}return b},clearTips:function(){for(var a=0;a<this.elements.tips.length;a++){this.elements.tips[a].remove()}for(var a=0;a<this.elements.tipTexts.length;a++){this.elements.tipTexts[a].remove()}this.elements.tips.splice(0);this.elements.tipTexts.splice(0)}};function LineRender(){}LineRender.prototype={};extend(LineRender.prototype,Render.prototype);function extend(){var k,c,a,b,g,h,f=arguments[0]||{},e=1,d=arguments.length,j=false;if(typeof f==="boolean"){j=f;f=arguments[1]||{};e=2}if(typeof f!=="object"&&!this.isFunction(f)){f={}}if(d===e){f=this;--e}for(;e<d;e++){if((k=arguments[e])!=null){for(c in k){a=f[c];b=k[c];if(f===b){continue}if(j&&b&&(this.isPlainObject(b)||(g=this.isArray(b)))){if(g){g=false;h=a&&this.isArray(a)?a:[]}else{h=a&&this.isPlainObject(a)?a:{}}f[c]=this.extend(j,h,b)}else{if(b!==undefined){f[c]=b}}}}}return f}function decimal(d,a){var c=parseFloat(d);if(isNaN(c)){return false}var c=Math.round(c*100)/100;var b=c.toString();var e=b.indexOf(".");if(e<0){e=b.length;b+="."}while(b.length<=e+a){b+="0"}return b};